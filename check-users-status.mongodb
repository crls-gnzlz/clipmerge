// ========================================
// ğŸ” Check Users Status in Database
// ========================================
// 
// Instructions:
// 1. Open MongoDB Compass
// 2. Connect to your MongoDB instance
// 3. Open the MongoDB Shell (mongosh) in Compass
// 4. Copy and paste this script
// 5. Press Enter to execute
//
// ========================================

// Switch to clipchain database
db = db.getSiblingDB('clipchain');

print("ğŸ” Checking users status in database...");

// Check all users
const users = db.users.find({}).toArray();
const userCount = users.length;

print(`\nğŸ“Š Total users found: ${userCount}`);

if (userCount === 0) {
  print("âŒ No users found in database!");
  print("ğŸ’¡ Tip: Create users using the API registration");
  quit();
}

print("\nğŸ‘¥ Users details:");
users.forEach((user, index) => {
  print(`\n${index + 1}. User: ${user.username}`);
  print(`   Email: ${user.email}`);
  print(`   Display Name: ${user.displayName || 'Not set'}`);
  print(`   Is Verified: ${user.isVerified || false}`);
  print(`   Created: ${user.createdAt}`);
  print(`   Password Hash: ${user.password ? 'Presente' : 'Ausente'}`);
  
  if (user.password) {
    print(`   Hash Length: ${user.password.length} characters`);
    print(`   Hash Starts With: ${user.password.substring(0, 10)}...`);
  }
});

// Check if test_user exists and has correct data
const testUser = db.users.findOne({ username: "test_user" });
if (testUser) {
  print("\nâœ… test_user found:");
  print(`   Username: ${testUser.username}`);
  print(`   Email: ${testUser.email}`);
  print(`   Password Hash: ${testUser.password ? 'Presente' : 'Ausente'}`);
  print(`   Is Verified: ${testUser.isVerified || false}`);
} else {
  print("\nâŒ test_user NOT found!");
  print("ğŸ’¡ Tip: Create test_user using the API registration");
}

// Check if creator_user exists
const creatorUser = db.users.findOne({ username: "creator_user" });
if (creatorUser) {
  print("\nâœ… creator_user found:");
  print(`   Username: ${creatorUser.username}`);
  print(`   Email: ${creatorUser.email}`);
  print(`   Password Hash: ${creatorUser.password ? 'Presente' : 'Ausente'}`);
  print(`   Is Verified: ${creatorUser.isVerified || false}`);
} else {
  print("\nâŒ creator_user NOT found!");
  print("ğŸ’¡ Tip: Create creator_user using the API registration");
}

// Check if demo_user exists
const demoUser = db.users.findOne({ username: "demo_user" });
if (demoUser) {
  print("\nâš ï¸ demo_user found (this might be causing conflicts):");
  print(`   Username: ${demoUser.username}`);
  print(`   Email: ${demoUser.email}`);
  print(`   Password Hash: ${demoUser.password ? 'Presente' : 'Ausente'}`);
  print(`   Is Verified: ${demoUser.isVerified || false}`);
} else {
  print("\nâ„¹ï¸ demo_user NOT found");
}

print("\nğŸ¯ Recommendations:");
if (testUser && testUser.password) {
  print("âœ… test_user exists and has password - should work for login");
} else {
  print("âŒ test_user missing or has no password - recreate using API");
}

if (creatorUser && creatorUser.password) {
  print("âœ… creator_user exists and has password - should work for login");
} else {
  print("âŒ creator_user missing or has no password - recreate using API");
}

if (demoUser) {
  print("âš ï¸ demo_user exists - consider removing to avoid conflicts");
}

print("\nğŸ’¡ Next steps:");
print("1. Use test_user / test123 for login");
print("2. If it fails, recreate users using the API");
print("3. Check that password hashing is working correctly");



