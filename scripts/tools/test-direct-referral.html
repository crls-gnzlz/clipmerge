<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Direct Referral Flow</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: white; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: #212529; }
        .url-test { background-color: #fff3cd; border-color: #ffeaa7; padding: 15px; border-radius: 8px; }
        .flow-diagram { background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .step { display: flex; align-items: center; margin: 10px 0; }
        .step-number { background-color: #007bff; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; }
        .arrow { margin: 0 15px; font-size: 20px; color: #007bff; }
    </style>
</head>
<body>
    <h1>üß™ Test: Flujo Directo de Referidos</h1>
    
    <div class="test-section info">
        <h3>üìã Cambios Implementados</h3>
        <p><strong>Antes:</strong> URL de referral ‚Üí P√°gina de landing ‚Üí Espera 2 segundos ‚Üí Redirecci√≥n al registro</p>
        <p><strong>Ahora:</strong> URL de referral ‚Üí <strong>Redirecci√≥n inmediata al registro</strong></p>
    </div>

    <div class="test-section">
        <h3>üîÑ Flujo Actual del Sistema</h3>
        <div class="flow-diagram">
            <div class="step">
                <div class="step-number">1</div>
                <div>Usuario hace clic en enlace de referral</div>
                <div class="arrow">‚Üí</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div>ReferralLanding procesa el referral ID</div>
                <div class="arrow">‚Üí</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div><strong>Redirecci√≥n inmediata al registro</strong></div>
                <div class="arrow">‚Üí</div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div>P√°gina de registro muestra informaci√≥n del referidor (sin referral ID) y formulario simplificado</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h3>üîó URLs de Prueba</h3>
        <div class="url-test">
            <p><strong>Frontend:</strong> http://localhost:5174/</p>
            <p><strong>URLs de Referral (Redirecci√≥n Directa):</strong></p>
            <ul>
                <li><a href="http://localhost:5174/ref/S74L7OQV" target="_blank">http://localhost:5174/ref/S74L7OQV</a> (carlos_test)</li>
                <li><a href="http://localhost:5174/ref/343JGWBW" target="_blank">http://localhost:5174/ref/343JGWBW</a> (demo_user)</li>
                <li><a href="http://localhost:5174/ref/12KKG9QM" target="_blank">http://localhost:5174/ref/12KKG9QM</a> (admin)</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h3>üß™ Test de Funcionalidad</h3>
        <button class="btn-primary" onclick="testReferralFlow()">Probar Flujo de Referral</button>
        <button class="btn-success" onclick="testAPI()">Probar API de Referral</button>
        <div id="testResults"></div>
    </div>

    <div class="test-section warning">
        <h3>‚ö†Ô∏è Instrucciones de Prueba</h3>
        <ol>
            <li><strong>Abrir una URL de referral</strong> (ej: http://localhost:5174/ref/S74L7OQV)</li>
            <li><strong>Verificar que redirija inmediatamente</strong> al registro (no debe mostrar p√°gina intermedia)</li>
            <li><strong>En el registro</strong> debe aparecer la informaci√≥n del referidor en un banner azul (sin mostrar el referral ID)</li>
        <li><strong>Formulario simplificado</strong> sin campo Display Name (solo username, email, password)</li>
            <li><strong>Completar el registro</strong> para verificar que se asocie al referidor</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>üìä Estado del Sistema</h3>
        <div id="systemStatus">
            <p>üîÑ Verificando estado...</p>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:9000/api';
        const FRONTEND_BASE = 'http://localhost:5174';

        // Verificar estado del sistema
        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            
            try {
                // Verificar backend
                const backendResponse = await fetch(`${API_BASE}/users/referral/S74L7OQV`);
                const backendOk = backendResponse.ok;
                
                // Verificar frontend
                const frontendResponse = await fetch(FRONTEND_BASE);
                const frontendOk = frontendResponse.ok;
                
                statusDiv.innerHTML = `
                    <div class="success">
                        <h4>‚úÖ Sistema Funcionando</h4>
                        <p><strong>Backend:</strong> ${backendOk ? '‚úÖ Conectado' : '‚ùå Error'}</p>
                        <p><strong>Frontend:</strong> ${frontendOk ? '‚úÖ Conectado' : '‚ùå Error'}</p>
                        <p><strong>API de Referrals:</strong> ${backendOk ? '‚úÖ Funcionando' : '‚ùå Error'}</p>
                    </div>
                `;
                
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="warning">
                        <h4>‚ö†Ô∏è Error de Conexi√≥n</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Test del flujo de referral
        async function testReferralFlow() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>üîÑ Probando flujo de referral...</p>';
            
            try {
                // Simular el flujo
                const referralId = 'S74L7OQV';
                const response = await fetch(`${API_BASE}/users/referral/${referralId}`);
                
                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="success">
                            <h4>‚úÖ Flujo de Referral Funcionando</h4>
                            <p><strong>Referral ID:</strong> ${referralId}</p>
                            <p><strong>Usuario Referidor:</strong> ${data.data.user.username}</p>
                            <p><strong>Display Name:</strong> ${data.data.user.displayName}</p>
                            <p><strong>Estado:</strong> API responde correctamente</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="warning">
                            <h4>‚ö†Ô∏è Error en API de Referral</h4>
                            <p>Status: ${response.status}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="warning">
                        <h4>‚ùå Error de Conexi√≥n</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Test de la API
        async function testAPI() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>üîÑ Probando API...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/users/referral/S74L7OQV`);
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <div class="success">
                        <h4>‚úÖ API Funcionando</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="warning">
                        <h4>‚ùå Error en API</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Inicializar
        checkSystemStatus();
    </script>
</body>
</html>
